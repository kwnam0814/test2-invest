# í´ë¼ìš°ë“œ AI Q&A ì„œë¹„ìŠ¤ (Cloudflare & Serverless)

**í”„ë¡œì íŠ¸ì˜ ëª¨ë“  ì˜ë„, ì•„í‚¤í…ì²˜, ê·¸ë¦¬ê³  ë¬¸ì œ í•´ê²° ê³¼ì •ì„ ë‹´ì€ ì´ê´„ ë¬¸ì„œì…ë‹ˆë‹¤. ì´ ë¬¸ì„œ í•˜ë‚˜ë¡œ í”„ë¡œì íŠ¸ì˜ ì „ì²´ ë§¥ë½ì„ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

---

## 1. ğŸ¯ í”„ë¡œì íŠ¸ ëª©í‘œ (Project Goal)

ì´ í”„ë¡œì íŠ¸ëŠ” ì‚¬ë‚´ ë¬¸ì„œë¥¼ ì—…ë¡œë“œí•˜ê³ , í•´ë‹¹ ë¬¸ì„œì˜ ë‚´ìš©ì— ëŒ€í•´ AIì—ê²Œ ììœ ë¡­ê²Œ ì§ˆë¬¸í•˜ë©° ë‹µë³€ì„ ì–»ì„ ìˆ˜ ìˆëŠ” **RAG(ê²€ìƒ‰ ì¦ê°• ìƒì„±) ê¸°ë°˜ì˜ Q&A ë¹„ì„œ**ë¥¼ êµ¬ì¶•í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤. íŠ¹íˆ, ì „ ì„¸ê³„ ì–´ë””ì„œë“  ë¹ ë¥´ê³  ì•ˆì •ì ìœ¼ë¡œ ì ‘ì†í•  ìˆ˜ ìˆë„ë¡ **Cloudflareì˜ ì„œë²„ë¦¬ìŠ¤(Serverless) ì¸í”„ë¼**ì— ë°°í¬í•˜ê³  ìš´ì˜í•©ë‹ˆë‹¤.

## 2. ğŸ›ï¸ ì•„í‚¤í…ì²˜ ë° ê¸°ìˆ  ìŠ¤íƒ (Architecture & Tech Stack)

ì´ ì„œë¹„ìŠ¤ëŠ” íŠ¹ì • ì„œë²„ ì—†ì´ ë™ì‘í•˜ëŠ” ì„œë²„ë¦¬ìŠ¤ ì•„í‚¤í…ì²˜ë¡œ êµ¬ì¶•ë˜ì–´, ê·¹ë„ì˜ í™•ì¥ì„±, ì•ˆì •ì„±, ê·¸ë¦¬ê³  ë¹„ìš© íš¨ìœ¨ì„±ì„ ìë‘í•©ë‹ˆë‹¤.

-   **Frontend:** `Pure HTML, CSS, Vanilla JavaScript`
-   **Backend:** `Cloudflare Pages Functions (Serverless)`
    -   ê¸°ì¡´ì˜ Node.js ì„œë²„(`server.js`)ë¥¼ ì™„ì „íˆ ì œê±°í•˜ê³ , ì „ ì„¸ê³„ì— ë¶„ì‚°ëœ Cloudflareì˜ ì—£ì§€ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì§ì ‘ ì‹¤í–‰ë˜ëŠ” Pages Functionsë¥¼ í†µí•´ ë°±ì—”ë“œ ë¡œì§ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
-   **[NEW] ì ‘ê·¼ ì œì–´ (Access Control):** `Cloudflare Middleware`
    -   `functions/_middleware.js` íŒŒì¼ì„ í†µí•´ ëª¨ë“  ìˆ˜ì‹  ìš”ì²­ì„ ì¤‘ì•™ì—ì„œ í†µì œí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ **í—ˆìš©ëœ IP ì£¼ì†Œë§Œ ì„œë¹„ìŠ¤ì— ì ‘ê·¼**í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê°•ë ¥í•œ ë³´ì•ˆ ê³„ì¸µì„ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤.
-   **AI Core: RAG & Vector Search:** `OpenAI API (Embeddings & GPT-4o-mini)`
    -   **RAG (ê²€ìƒ‰ ì¦ê°• ìƒì„±)** ì•„í‚¤í…ì²˜ë¥¼ í†µí•´ **ë¬¸ì„œì— ê¸°ë°˜í•œ ì‚¬ì‹¤ì ì¸ ë‹µë³€**ì„ ìƒì„±í•©ë‹ˆë‹¤.
-   **AI Memory (Database):** `Cloudflare KV`
    -   Cloudflareì˜ Key-Value ìŠ¤í† ë¦¬ì§€ì¸ KVë¥¼ AIì˜ 'ì™¸ë¶€ ë‡Œ(ì˜êµ¬ ê¸°ì–µ ì¥ì¹˜)'ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

## 3. ğŸ’¡ í•µì‹¬ ê¸°ëŠ¥ ë° êµ¬í˜„ ê³¼ì •

### ì£¼ìš” ê¸°ëŠ¥

-   **[NEW] IP ê¸°ë°˜ ì ‘ê·¼ ì œì–´:** ì§€ì •ëœ IP ì£¼ì†Œì—ì„œë§Œ ì„œë¹„ìŠ¤ì— ì ‘ì†í•  ìˆ˜ ìˆë„ë¡ í•˜ì—¬, ë‚´ë¶€ìš© ë˜ëŠ” ë¹„ê³µê°œìš©ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ìš´ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
-   **ì§„ì •í•œ ë‹¤êµ­ì–´ ì§ˆì˜ì‘ë‹µ:** AIê°€ ì‚¬ìš©ìì˜ ì§ˆë¬¸ ì–¸ì–´ë¥¼ ìë™ìœ¼ë¡œ ê°ì§€í•˜ì—¬, í•´ë‹¹ ì–¸ì–´ë¡œ ì‹¤ì‹œê°„ ì†Œí†µí•©ë‹ˆë‹¤.
-   **ëŒ€í™”í˜• ë‹¤êµ­ì–´ ìš”ì•½:** AIì™€ì˜ ëŒ€í™”ë¥¼ í†µí•´ ë¬¸ì„œ ì „ì²´ì˜ ë‚´ìš©ì„ ì›í•˜ëŠ” ì–¸ì–´ë¡œ ê°„ê²°í•˜ê²Œ ìš”ì•½ ë°›ìŠµë‹ˆë‹¤.
-   **ì„œë²„ë¦¬ìŠ¤ ì•„í‚¤í…ì²˜:** íŠ¹ì • ì„œë²„ ì—†ì´ Cloudflareì˜ ê¸€ë¡œë²Œ ë„¤íŠ¸ì›Œí¬ì—ì„œ ë™ì‘í•©ë‹ˆë‹¤.

### ì£¼ìš” ë¬¸ì œ í•´ê²° ê³¼ì • (Key Challenges & Solutions)

1.  **ë¬¸ì œ: ì„œë¹„ìŠ¤ì˜ ë¹„ê³µê°œ ìš´ì˜ í•„ìš”ì„±**
    -   **í˜„ìƒ:** ê¸°ë³¸ì ìœ¼ë¡œ Cloudflare PagesëŠ” ì „ ì„¸ê³„ì— ê³µê°œì ìœ¼ë¡œ ë°°í¬ë˜ì–´, ëˆ„êµ¬ë‚˜ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
    -   **í•´ê²°: ì ‘ê·¼ ì œì–´ ë¯¸ë“¤ì›¨ì–´(IP Allowlist) ë„ì…**
        -   Cloudflare Pages Functionsì˜ **ë¯¸ë“¤ì›¨ì–´(`_middleware.js`)** ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬, ëª¨ë“  ìš”ì²­ì´ ì‹¤ì œ APIë‚˜ í˜ì´ì§€ì— ë„ë‹¬í•˜ê¸° ì „ì— ë¨¼ì € ê±°ì¹˜ëŠ” 'ê²€ë¬¸ì†Œ'ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.
        -   ì´ ê²€ë¬¸ì†ŒëŠ” ìš”ì²­ìì˜ IP ì£¼ì†Œ(`CF-Connecting-IP`)ë¥¼ í™•ì¸í•˜ì—¬, **ë¯¸ë¦¬ ì •ì˜ëœ í—ˆìš© ëª©ë¡(Allowlist)**ì— ìˆëŠ” IPì¼ ê²½ìš°ì—ë§Œ ìš”ì²­ì„ í†µê³¼ì‹œí‚µë‹ˆë‹¤.
        -   ì´ë¥¼ í†µí•´ ë°°í¬ ì‹¤íŒ¨ ë¬¸ì œì™€ëŠ” ë³„ê°œë¡œ, ì„œë¹„ìŠ¤ë¥¼ ì›í•˜ëŠ” íŠ¹ì • ì‚¬ìš©ì ê·¸ë£¹ì—ê²Œë§Œ ì•ˆì „í•˜ê²Œ ì œê³µí•  ìˆ˜ ìˆëŠ” ê°•ë ¥í•œ ë³´ì•ˆ ì•„í‚¤í…ì²˜ë¥¼ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤.

## 4. ğŸš€ Cloudflare ë°°í¬ ë° ì„¤ì • ë°©ë²•

### 4.1. ë°°í¬ ì ˆì°¨

(ì´ì „ê³¼ ë™ì¼)

### 4.2. [ì¤‘ìš”] IP ì ‘ê·¼ ì œì–´ ì„¤ì •

`functions/_middleware.js` íŒŒì¼ ë˜ëŠ” Cloudflare ëŒ€ì‹œë³´ë“œë¥¼ í†µí•´ ì ‘ì†ì„ í—ˆìš©í•  IPë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

-   **ë°©ë²• 1: ì½”ë“œì—ì„œ ì§ì ‘ ìˆ˜ì • (ê°„ë‹¨í•œ ë°©ë²•)**
    -   `functions/_middleware.js` íŒŒì¼ì„ ì—´ê³  `allowedIps` ë°°ì—´ì— í—ˆìš©í•  IP ì£¼ì†Œë¥¼ ì§ì ‘ ì¶”ê°€í•©ë‹ˆë‹¤.
    ```javascript
    // ì˜ˆì‹œ: íŠ¹ì • IP ë‘ ê°œë§Œ í—ˆìš©
    const allowedIps = ["192.168.1.10", "8.8.8.8"];
    ```

-   **ë°©ë²• 2: Cloudflare í™˜ê²½ ë³€ìˆ˜ ì‚¬ìš© (ê¶Œì¥)**
    -   ì½”ë“œë¥¼ ìˆ˜ì •í•˜ê³  ë‹¤ì‹œ ë°°í¬í•  í•„ìš” ì—†ì´, Cloudflare ëŒ€ì‹œë³´ë“œì—ì„œ ë™ì ìœ¼ë¡œ IP ëª©ë¡ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    1.  Cloudflare ëŒ€ì‹œë³´ë“œ > `Workers & Pages` > í”„ë¡œì íŠ¸ ì„ íƒ > `Settings` > `Environment variables` ë¡œ ì´ë™í•©ë‹ˆë‹¤.
    2.  `Add variable`ì„ í´ë¦­í•˜ê³ , ë³€ìˆ˜ ì´ë¦„ì€ `ALLOWED_IPS`ë¡œ, ê°’ì€ í—ˆìš©í•  IP ì£¼ì†Œë“¤ì„ ì‰¼í‘œ(`,`)ë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥í•©ë‹ˆë‹¤. (ì˜ˆ: `11.22.33.44,55.66.77.88`)
    3.  `Save`ë¥¼ ëˆŒëŸ¬ ì €ì¥í•©ë‹ˆë‹¤.

## 5. ğŸ“‚ íŒŒì¼ êµ¬ì¡° (File Structure)

```
/
â”œâ”€â”€ functions/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ [[path]].js    # API ë¼ìš°íŒ… ë° í•¸ë“¤ëŸ¬
â”‚   â””â”€â”€ _middleware.js     # [NEW] ëª¨ë“  ìš”ì²­ì„ ìœ„í•œ IP ì ‘ê·¼ ì œì–´ ë¯¸ë“¤ì›¨ì–´
â”œâ”€â”€ public/                # í”„ë¡ íŠ¸ì—”ë“œ (HTML/CSS/JS)
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ style.css
â”‚   â””â”€â”€ main.js
â”œâ”€â”€ package.json           # í”„ë¡œì íŠ¸ ì •ë³´ ë° ì˜ì¡´ì„±
â”œâ”€â”€ wrangler.toml          # Cloudflare ë°°í¬ ì„¤ì • íŒŒì¼
â””â”€â”€ README.md              # í”„ë¡œì íŠ¸ ì´ê´„ ë¬¸ì„œ
```
